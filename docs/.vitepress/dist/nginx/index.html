<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>1.介绍 | 葡挞的资料库</title>
    <meta name="description" content="葡挞的资料库">
    <meta name="generator" content="VitePress v1.3.4">
    <link rel="preload stylesheet" href="/flow/docs/assets/style.DkuylAEv.css" as="style">
    
    <script type="module" src="/flow/docs/assets/app.BCqOtQ02.js"></script>
    <link rel="preload" href="/flow/docs/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/flow/docs/assets/chunks/theme.Bek9ral5.js">
    <link rel="modulepreload" href="/flow/docs/assets/chunks/framework.BFVHecrR.js">
    <link rel="modulepreload" href="/flow/docs/assets/nginx_index.md.CqoPmPz4.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-215f30b8><!--[--><!--]--><!--[--><span tabindex="-1" data-v-907be939></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-907be939> Skip to content </a><!--]--><!----><header class="VPNav" data-v-215f30b8 data-v-3e0cdc8a><div class="VPNavBar" data-v-3e0cdc8a data-v-430a4570><div class="wrapper" data-v-430a4570><div class="container" data-v-430a4570><div class="title" data-v-430a4570><div class="VPNavBarTitle has-sidebar" data-v-430a4570 data-v-6d4c4ad2><a class="title" href="/flow/docs/" data-v-6d4c4ad2><!--[--><!--]--><!----><span data-v-6d4c4ad2>葡挞的资料库</span><!--[--><!--]--></a></div></div><div class="content" data-v-430a4570><div class="content-body" data-v-430a4570><!--[--><!--]--><div class="VPNavBarSearch search" data-v-430a4570><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-430a4570 data-v-4cd6f9ff><span id="main-nav-aria-label" class="visually-hidden" data-v-4cd6f9ff> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/flow/docs/" tabindex="0" data-v-4cd6f9ff data-v-694f7fc3><!--[--><span data-v-694f7fc3>首页</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/flow/docs/javascript.html" tabindex="0" data-v-4cd6f9ff data-v-694f7fc3><!--[--><span data-v-694f7fc3>文档</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-430a4570 data-v-5b018ea6><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-5b018ea6 data-v-f9119fd5 data-v-2bcfd049><span class="check" data-v-2bcfd049><span class="icon" data-v-2bcfd049><!--[--><span class="vpi-sun sun" data-v-f9119fd5></span><span class="vpi-moon moon" data-v-f9119fd5></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-430a4570 data-v-7eab4231 data-v-e535836f><!--[--><a class="VPSocialLink no-icon" href="https://github.com/vuejs/vitepress" aria-label="github" target="_blank" rel="noopener" data-v-e535836f data-v-ea8a6492><span class="vpi-social-github" /></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-430a4570 data-v-398f807d data-v-f75f569c><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-f75f569c><span class="vpi-more-horizontal icon" data-v-f75f569c></span></button><div class="menu" data-v-f75f569c><div class="VPMenu" data-v-f75f569c data-v-28c04245><!----><!--[--><!--[--><!----><div class="group" data-v-398f807d><div class="item appearance" data-v-398f807d><p class="label" data-v-398f807d>Appearance</p><div class="appearance-action" data-v-398f807d><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-398f807d data-v-f9119fd5 data-v-2bcfd049><span class="check" data-v-2bcfd049><span class="icon" data-v-2bcfd049><!--[--><span class="vpi-sun sun" data-v-f9119fd5></span><span class="vpi-moon moon" data-v-f9119fd5></span><!--]--></span></span></button></div></div></div><div class="group" data-v-398f807d><div class="item social-links" data-v-398f807d><div class="VPSocialLinks social-links-list" data-v-398f807d data-v-e535836f><!--[--><a class="VPSocialLink no-icon" href="https://github.com/vuejs/vitepress" aria-label="github" target="_blank" rel="noopener" data-v-e535836f data-v-ea8a6492><span class="vpi-social-github" /></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-430a4570 data-v-a26f1834><span class="container" data-v-a26f1834><span class="top" data-v-a26f1834></span><span class="middle" data-v-a26f1834></span><span class="bottom" data-v-a26f1834></span></span></button></div></div></div></div><div class="divider" data-v-430a4570><div class="divider-line" data-v-430a4570></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-215f30b8 data-v-4575f610><div class="container" data-v-4575f610><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-4575f610><span class="vpi-align-left menu-icon" data-v-4575f610></span><span class="menu-text" data-v-4575f610>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-4575f610 data-v-f4de3fa8><button data-v-f4de3fa8>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-215f30b8 data-v-d95b4f58><div class="curtain" data-v-d95b4f58></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-d95b4f58><span class="visually-hidden" id="sidebar-aria-label" data-v-d95b4f58> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-a58c0ffb><section class="VPSidebarItem level-0" data-v-a58c0ffb data-v-588c1e06><div class="item" role="button" tabindex="0" data-v-588c1e06><div class="indicator" data-v-588c1e06></div><h2 class="text" data-v-588c1e06>环境区别</h2><!----></div><div class="items" data-v-588c1e06><!--[--><div class="VPSidebarItem level-1 is-link" data-v-588c1e06 data-v-588c1e06><div class="item" data-v-588c1e06><div class="indicator" data-v-588c1e06></div><a class="VPLink link link" href="/flow/docs/tt.html" data-v-588c1e06><!--[--><p class="text" data-v-588c1e06>环境区别</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a58c0ffb><section class="VPSidebarItem level-0" data-v-a58c0ffb data-v-588c1e06><div class="item" role="button" tabindex="0" data-v-588c1e06><div class="indicator" data-v-588c1e06></div><h2 class="text" data-v-588c1e06>Javascript</h2><!----></div><div class="items" data-v-588c1e06><!--[--><div class="VPSidebarItem level-1 is-link" data-v-588c1e06 data-v-588c1e06><div class="item" data-v-588c1e06><div class="indicator" data-v-588c1e06></div><a class="VPLink link link" href="/flow/docs/javascript.html" data-v-588c1e06><!--[--><p class="text" data-v-588c1e06>js高级</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a58c0ffb><section class="VPSidebarItem level-0" data-v-a58c0ffb data-v-588c1e06><div class="item" role="button" tabindex="0" data-v-588c1e06><div class="indicator" data-v-588c1e06></div><h2 class="text" data-v-588c1e06>React</h2><!----></div><div class="items" data-v-588c1e06><!--[--><div class="VPSidebarItem level-1 is-link" data-v-588c1e06 data-v-588c1e06><div class="item" data-v-588c1e06><div class="indicator" data-v-588c1e06></div><a class="VPLink link link" href="/flow/docs/react.html" data-v-588c1e06><!--[--><p class="text" data-v-588c1e06>react基础</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-588c1e06 data-v-588c1e06><div class="item" data-v-588c1e06><div class="indicator" data-v-588c1e06></div><a class="VPLink link link" href="/flow/docs/react/react-high.html" data-v-588c1e06><!--[--><p class="text" data-v-588c1e06>react高级</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-588c1e06 data-v-588c1e06><div class="item" data-v-588c1e06><div class="indicator" data-v-588c1e06></div><a class="VPLink link link" href="/flow/docs/react/react-hooks.html" data-v-588c1e06><!--[--><p class="text" data-v-588c1e06>reactHooks</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-588c1e06 data-v-588c1e06><div class="item" data-v-588c1e06><div class="indicator" data-v-588c1e06></div><a class="VPLink link link" href="/flow/docs/react/react-router.html" data-v-588c1e06><!--[--><p class="text" data-v-588c1e06>reactRouter</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-588c1e06 data-v-588c1e06><div class="item" data-v-588c1e06><div class="indicator" data-v-588c1e06></div><a class="VPLink link link" href="/flow/docs/react/redux.html" data-v-588c1e06><!--[--><p class="text" data-v-588c1e06>redux</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a58c0ffb><section class="VPSidebarItem level-0" data-v-a58c0ffb data-v-588c1e06><div class="item" role="button" tabindex="0" data-v-588c1e06><div class="indicator" data-v-588c1e06></div><h2 class="text" data-v-588c1e06>Typescript</h2><!----></div><div class="items" data-v-588c1e06><!--[--><div class="VPSidebarItem level-1 is-link" data-v-588c1e06 data-v-588c1e06><div class="item" data-v-588c1e06><div class="indicator" data-v-588c1e06></div><a class="VPLink link link" href="/flow/docs/typescript.html" data-v-588c1e06><!--[--><p class="text" data-v-588c1e06>typescript</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a58c0ffb><section class="VPSidebarItem level-0" data-v-a58c0ffb data-v-588c1e06><div class="item" role="button" tabindex="0" data-v-588c1e06><div class="indicator" data-v-588c1e06></div><h2 class="text" data-v-588c1e06>工程化</h2><!----></div><div class="items" data-v-588c1e06><!--[--><div class="VPSidebarItem level-1 is-link" data-v-588c1e06 data-v-588c1e06><div class="item" data-v-588c1e06><div class="indicator" data-v-588c1e06></div><a class="VPLink link link" href="/flow/docs/engineering/node-basic.html" data-v-588c1e06><!--[--><p class="text" data-v-588c1e06>node基础</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-588c1e06 data-v-588c1e06><div class="item" data-v-588c1e06><div class="indicator" data-v-588c1e06></div><a class="VPLink link link" href="/flow/docs/engineering/node-high.html" data-v-588c1e06><!--[--><p class="text" data-v-588c1e06>node高级</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-588c1e06 data-v-588c1e06><div class="item" data-v-588c1e06><div class="indicator" data-v-588c1e06></div><a class="VPLink link link" href="/flow/docs/engineering/webpack.html" data-v-588c1e06><!--[--><p class="text" data-v-588c1e06>webpack</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-588c1e06 data-v-588c1e06><div class="item" data-v-588c1e06><div class="indicator" data-v-588c1e06></div><a class="VPLink link link" href="/flow/docs/engineering/mysql.html" data-v-588c1e06><!--[--><p class="text" data-v-588c1e06>mysql</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-588c1e06 data-v-588c1e06><div class="item" data-v-588c1e06><div class="indicator" data-v-588c1e06></div><a class="VPLink link link" href="/flow/docs/engineering/tool.html" data-v-588c1e06><!--[--><p class="text" data-v-588c1e06>前端工具</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a58c0ffb><section class="VPSidebarItem level-0" data-v-a58c0ffb data-v-588c1e06><div class="item" role="button" tabindex="0" data-v-588c1e06><div class="indicator" data-v-588c1e06></div><h2 class="text" data-v-588c1e06>Linux</h2><!----></div><div class="items" data-v-588c1e06><!--[--><div class="VPSidebarItem level-1 is-link" data-v-588c1e06 data-v-588c1e06><div class="item" data-v-588c1e06><div class="indicator" data-v-588c1e06></div><a class="VPLink link link" href="/flow/docs/linux.html" data-v-588c1e06><!--[--><p class="text" data-v-588c1e06>Linux基础</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-588c1e06 data-v-588c1e06><div class="item" data-v-588c1e06><div class="indicator" data-v-588c1e06></div><a class="VPLink link link" href="/flow/docs/linux/shell.html" data-v-588c1e06><!--[--><p class="text" data-v-588c1e06>Shell</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-588c1e06 data-v-588c1e06><div class="item" data-v-588c1e06><div class="indicator" data-v-588c1e06></div><a class="VPLink link link" href="/flow/docs/linux/software-package.html" data-v-588c1e06><!--[--><p class="text" data-v-588c1e06>软件包管理</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a58c0ffb><section class="VPSidebarItem level-0" data-v-a58c0ffb data-v-588c1e06><div class="item" role="button" tabindex="0" data-v-588c1e06><div class="indicator" data-v-588c1e06></div><h2 class="text" data-v-588c1e06>Nginx</h2><!----></div><div class="items" data-v-588c1e06><!--[--><div class="VPSidebarItem level-1 is-link" data-v-588c1e06 data-v-588c1e06><div class="item" data-v-588c1e06><div class="indicator" data-v-588c1e06></div><a class="VPLink link link" href="/flow/docs/nginx.html" data-v-588c1e06><!--[--><p class="text" data-v-588c1e06>Nginx</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-215f30b8 data-v-94b9754a><div class="VPDoc has-sidebar has-aside" data-v-94b9754a data-v-59f87038><!--[--><!--]--><div class="container" data-v-59f87038><div class="aside" data-v-59f87038><div class="aside-curtain" data-v-59f87038></div><div class="aside-container" data-v-59f87038><div class="aside-content" data-v-59f87038><div class="VPDocAside" data-v-59f87038 data-v-6b0ac53c><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-6b0ac53c data-v-f9ffab51><div class="content" data-v-f9ffab51><div class="outline-marker" data-v-f9ffab51></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-f9ffab51>On this page</div><ul class="VPDocOutlineItem root" data-v-f9ffab51 data-v-2222d9cf><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-6b0ac53c></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-59f87038><div class="content-container" data-v-59f87038><!--[--><!--]--><main class="main" data-v-59f87038><div style="position:relative;" class="vp-doc _flow_docs_nginx_" data-v-59f87038><div><h1 id="_1-介绍" tabindex="-1">1.介绍 <a class="header-anchor" href="#_1-介绍" aria-label="Permalink to &quot;1.介绍&quot;">​</a></h1><h2 id="_1-1-nginx-优势" tabindex="-1">1.1 nginx 优势 <a class="header-anchor" href="#_1-1-nginx-优势" aria-label="Permalink to &quot;1.1 nginx 优势&quot;">​</a></h2><ul><li><strong>高并发高性能</strong></li><li><strong>可拓展性好</strong><ul><li>nginx 源码内核非常小，功能不多，但是他的每个功能都是通过模块实现的，所以可以通过添加和删除模块来实现不同的功能，且非常方便二次开发</li></ul></li><li><strong>高可靠性</strong></li><li><strong>热部署</strong><ul><li>类似于前端的热更新，而且是丝滑部署，当更新配置的时候，会产生一个.old 后缀的文件，比如 a 客户端正在访问，这时候更新了配置，这时候会将老的配置生成.old 后缀的文件 那么 a 客户端会继续访问.old 后缀配置相关的内容，现在 b 客户端来访问，就会访问新的配置文件</li></ul></li><li><strong>开源许可证</strong></li></ul><h2 id="_1-2-nginx-的架构" tabindex="-1">1.2 nginx 的架构 <a class="header-anchor" href="#_1-2-nginx-的架构" aria-label="Permalink to &quot;1.2 nginx 的架构&quot;">​</a></h2><h3 id="_1-2-1-轻量" tabindex="-1">1.2.1 轻量 <a class="header-anchor" href="#_1-2-1-轻量" aria-label="Permalink to &quot;1.2.1 轻量&quot;">​</a></h3><ul><li>源码只包含核心模块</li><li>其他非核心功能都是通过模块实现的，可自由选择</li></ul><h3 id="_1-2-2-架构" tabindex="-1">1.2.2 架构 <a class="header-anchor" href="#_1-2-2-架构" aria-label="Permalink to &quot;1.2.2 架构&quot;">​</a></h3><p>nginx 采用的是多进程(单线程)和多路 IO 复用模型</p><h3 id="_1-2-3-工作流程" tabindex="-1">1.2.3 工作流程 <a class="header-anchor" href="#_1-2-3-工作流程" aria-label="Permalink to &quot;1.2.3 工作流程&quot;">​</a></h3><ul><li>Nginx 在启动后，会有一个 master 进程和多个相互独立的 worker 进程</li><li>master 进程接收到请求后，会把这个请求分配给 worker 进程，所以每个 worker 进程都可能会处理这个请求(有可能第一个 worker 处理，也可能第二个 worker 处理)</li><li>master 进程能监控 worker 进程的运行状态，当 worker 进程退出后(异常情况下)，会启动新的 worker 进程</li></ul><p><a href="https://excalidraw.com/#json=tvponPHAvQTD7eXarIzyw,PSCPS4j4Fb8198InfMruOA" target="_blank" rel="noreferrer">工作流程图</a></p><ul><li>worker 进程数，一般会设置成机器的 cpu 核数，因为更多的 worker 数，只会导致进程相互竞争 cpu，从而带来不必要的上下文切换</li><li>使用多进程模式，不仅能提高并发率，而且进程之间相互独立，一个 worker 进程挂了不会影响到其他 worker 进程</li></ul><p><strong>举例</strong></p><p>比如现在酒店有领班的，领班的会分配不同服务员接待的区域，领班一般是不会去接待的，他只负责统筹服务员，比如现在有一个服务员要请假了，那么他就会赶紧安排新的服务员去负责这片区域。</p><p>那么 master 就相当于领班，当有 worker 进程挂了，会启动新的 worker 进程</p><h1 id="_2-安装" tabindex="-1">2.安装 <a class="header-anchor" href="#_2-安装" aria-label="Permalink to &quot;2.安装&quot;">​</a></h1><h2 id="linux-下安装" tabindex="-1">Linux 下安装 <a class="header-anchor" href="#linux-下安装" aria-label="Permalink to &quot;Linux 下安装&quot;">​</a></h2><p><strong>CentOS 7</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 安装</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nginx</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 查看版本号</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nginx</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -V</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 查看编译时的参数</span></span></code></pre></div><p><strong>nginx -V 参数表示的意思</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>--prefix  # 把nginx安装到哪个目录下</span></span>
<span class="line"><span>--sbin-path # 可执行文件的路径</span></span>
<span class="line"><span>--modules-path # 安装的额外模块路径</span></span>
<span class="line"><span>--conf-path # 配置文件的路径</span></span>
<span class="line"><span>--error-log-path # 错误日志路径</span></span>
<span class="line"><span>--http-log-path= # 普通日志路径</span></span>
<span class="line"><span>--pid-path # 进程ID路径</span></span>
<span class="line"><span>--lock-path # 加锁文件路径</span></span>
<span class="line"><span></span></span>
<span class="line"><span>-------下面是demo-----------</span></span>
<span class="line"><span>--prefix=/usr/share/nginx</span></span>
<span class="line"><span>--sbin-path=/usr/sbin/nginx</span></span>
<span class="line"><span>--modules-path=/usr/lib64/nginx/modules</span></span>
<span class="line"><span>--conf-path=/etc/nginx/nginx.conf</span></span>
<span class="line"><span>--error-log-path=/var/log/nginx/error.log</span></span>
<span class="line"><span>--http-log-path=/var/log/nginx/access.log</span></span>
<span class="line"><span>--http-client-body-temp-path=/var/lib/nginx/tmp/client_body</span></span>
<span class="line"><span>--http-proxy-temp-path=/var/lib/nginx/tmp/proxy</span></span>
<span class="line"><span>--http-fastcgi-temp-path=/var/lib/nginx/tmp/fastcgi</span></span>
<span class="line"><span>--http-uwsgi-temp-path=/var/lib/nginx/tmp/uwsgi</span></span>
<span class="line"><span>--http-scgi-temp-path=/var/lib/nginx/tmp/scgi</span></span>
<span class="line"><span>--pid-path=/run/nginx.pid</span></span>
<span class="line"><span>--lock-path=/run/lock/subsys/nginx</span></span>
<span class="line"><span>--user=nginx</span></span>
<span class="line"><span>--group=nginx</span></span>
<span class="line"><span>--with-compat</span></span>
<span class="line"><span>--with-debug</span></span>
<span class="line"><span>--with-file-aio</span></span>
<span class="line"><span>--with-google_perftools_module</span></span>
<span class="line"><span>--with-http_addition_module</span></span>
<span class="line"><span>--with-http_auth_request_module</span></span>
<span class="line"><span>--with-http_dav_module</span></span>
<span class="line"><span>--with-http_degradation_module</span></span>
<span class="line"><span>--with-http_flv_module</span></span>
<span class="line"><span>--with-http_gunzip_module</span></span>
<span class="line"><span>--with-http_gzip_static_module</span></span>
<span class="line"><span>--with-http_image_filter_module=dynamic</span></span>
<span class="line"><span>--with-http_mp4_module</span></span>
<span class="line"><span>--with-http_perl_module=dynamic</span></span>
<span class="line"><span>--with-http_random_index_module</span></span>
<span class="line"><span>--with-http_realip_module</span></span>
<span class="line"><span>--with-http_secure_link_module</span></span>
<span class="line"><span>--with-http_slice_module</span></span>
<span class="line"><span>--with-http_ssl_module</span></span>
<span class="line"><span>--with-http_stub_status_module</span></span>
<span class="line"><span>--with-http_sub_module</span></span>
<span class="line"><span>--with-http_v2_module</span></span>
<span class="line"><span>--with-http_xslt_module=dynamic</span></span>
<span class="line"><span>--with-mail=dynamic</span></span>
<span class="line"><span>--with-mail_ssl_module</span></span>
<span class="line"><span>--with-pcre</span></span>
<span class="line"><span>--with-pcre-jit</span></span>
<span class="line"><span>--with-stream=dynamic</span></span>
<span class="line"><span>--with-stream_ssl_module</span></span>
<span class="line"><span>--with-stream_ssl_preread_module</span></span>
<span class="line"><span>--with-threads</span></span>
<span class="line"><span>--with-cc-opt=&#39;-O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector-strong</span></span>
<span class="line"><span>--param=ssp-buffer-size=4 -grecord-gcc-switches -specs=/usr/lib/rpm/redhat/redhat-hardened-cc1 -m64 -mtune=generic&#39; --with-ld-opt=&#39;-Wl,-z,relro -specs=/usr/lib/rpm/redhat/redhat-hardened-ld -Wl,-E&#39;</span></span></code></pre></div><h1 id="_3-目录" tabindex="-1">3.目录 <a class="header-anchor" href="#_3-目录" aria-label="Permalink to &quot;3.目录&quot;">​</a></h1><h2 id="_3-1-安装目录" tabindex="-1">3.1 安装目录 <a class="header-anchor" href="#_3-1-安装目录" aria-label="Permalink to &quot;3.1 安装目录&quot;">​</a></h2><p><strong>查看 nginx 安装的配置目录和文件</strong></p><ul><li>查看安装 nginx 的时候会安装哪些文件，和当前文件的路径</li><li>下面的 xxx 文件都是这个命令显示的文件</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rpm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -ql</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx</span></span></code></pre></div><h2 id="_3-2-配置文件核心结构" tabindex="-1">3.2 配置文件核心结构 <a class="header-anchor" href="#_3-2-配置文件核心结构" aria-label="Permalink to &quot;3.2 配置文件核心结构&quot;">​</a></h2><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"></span></code></pre></div><h2 id="_3-3-主配置文件" tabindex="-1">3.3 主配置文件 <a class="header-anchor" href="#_3-3-主配置文件" aria-label="Permalink to &quot;3.3 主配置文件&quot;">​</a></h2><h3 id="_3-3-1-核心配置文件" tabindex="-1">3.3.1 核心配置文件 <a class="header-anchor" href="#_3-3-1-核心配置文件" aria-label="Permalink to &quot;3.3.1 核心配置文件&quot;">​</a></h3><p>目录地址：<strong>/etc/nginx/nginx.conf</strong></p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># nginx的key 和value 是靠空格分隔 空格的数量是任意的</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">user </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            nginx;  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 启用nginx的用户</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">worker_processes </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">auto; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># worker进程数量 一般要和cpu核数相等</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">error_log </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/var/log/nginx/error.log </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">warn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 错误日志的路径 warn 表示日志的格式 有的配置文件可能没有</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">pid </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      /run/nginx.pid; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 进程ID写入的文件</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">events</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    worker_connections </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1024</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 工作进程的最大连接数 如果超过这个数的连接就会被丢掉</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  	# 定义日志的格式</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    log_format </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> main</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &#39;$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">remote_addr</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> - $</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">remote_user</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> [$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">time_local</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">] &quot;$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">request</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot; &#39;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                      &#39;$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">status</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> $</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">body_bytes_sent</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">http_referer</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot; &#39;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                      &#39;&quot;$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">http_user_agent</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot; &quot;$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">http_x_forwarded_for</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    access_log </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /var/log/nginx/access.log  </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 访问日志写入的文件 mian表示使用这中格式写入</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    sendfile </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">           on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 零拷贝模式开关</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    tcp_nopush </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">         on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    tcp_nodelay </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    keepalive_timeout </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  65</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 保持连接的超时时间</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    types_hash_max_size </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4096</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  	# gzip                on; # 是否启用gzip压缩</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    include </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            /etc/nginx/mime.types; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 包含的mime文件  比如客户端访问index.js那么服务器就会返回一个Content—type字段值就是 根据访问的文件(index.js)生成的类型 这个类型一定是mime文件的某个类型，因为这样nginx才认识</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    default_type </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       application/octet-stream;  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 如果现在返回的一个类型不在mime文件中 那么就会使用这个默认的类型返回给浏览器</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    include </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/etc/nginx/conf.d/*.conf;  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 还要包含这个文件下的所有配置文件</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="_3-3-2-默认-http-服务配置文件" tabindex="-1">3.3.2 默认 http 服务配置文件 <a class="header-anchor" href="#_3-3-2-默认-http-服务配置文件" aria-label="Permalink to &quot;3.3.2 默认 http 服务配置文件&quot;">​</a></h3><p>目录地址：<strong>/etc/nginx/nginx.conf.default</strong></p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># http只有一个。里面可以有多个server</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    include </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      mime.types;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    default_type </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> application/octet-stream;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    #log_format  main  &#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    #                  &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    #                  &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    #access_log  logs/access.log  main; # 访问日志写入的文件 mian表示使用这中格式写入</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    sendfile </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">       on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    #tcp_nopush     on;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    #keepalive_timeout  0;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    keepalive_timeout </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 65</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    #gzip  on;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   # 配置服务的 也是最核心的配置文件</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        listen </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      80</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 监听的端口 nginx启动后默认监听80端口</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        server_name </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> localhost; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 服务名字或者是域名或者是IP</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        #charset koi8-r; # 字符集 俄语的字符集 因为作者是俄罗斯的 所以默认写了一个这个 可以自己设置</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        #access_log  logs/host.access.log  main;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    		# location是重点之中的重点</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    		# 表示如果访问/ 那么就会进入这个配置 然后去html文件夹下找到index.html 如果index.html没有就找 index.htm</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> / </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            root </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  html; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 文件根路径</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            index </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> index.html index.htm; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 默认访问的文件</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        #error_page  404              /404.html;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # redirect server error pages to the static page /50x.html</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        #</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        error_page </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  500</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 502</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 503</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 504</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  /50x.html; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 如果状态码是500 502 503 504 重定向50x.html</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        location</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> /50x.html </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            root </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  html;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h1 id="_4-server-模块" tabindex="-1">4.server 模块 <a class="header-anchor" href="#_4-server-模块" aria-label="Permalink to &quot;4.server 模块&quot;">​</a></h1><p><strong>nginx 有一个主配置文件<code>nginx.conf</code>里面有一个，里面只有一个<code>http</code>, <code>http </code>中可以有多个<code>server</code></strong></p><h2 id="_4-1-root-和-alias-的区别" tabindex="-1">4.1.root 和 alias 的区别 <a class="header-anchor" href="#_4-1-root-和-alias-的区别" aria-label="Permalink to &quot;4.1.root 和 alias 的区别&quot;">​</a></h2><ul><li>使用 root 那么在访问的时候就会<strong>拼接 location 对应的地址</strong></li></ul><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 当访问/random的时候 nginx会去 /opt/app/random文件夹下寻找文件</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> /random </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    root </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/opt/app;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    index </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">index.html;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><ul><li>使用 alias 访问的时候<strong>不会</strong>拼接 location 对应的地址</li></ul><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 当访问/random的时候 nginx会去 /opt/app文件夹下寻找文件</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> /random </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    root </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/opt/app;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    index </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">index.html;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h1 id="_5-核心模块" tabindex="-1">5.核心模块 <a class="header-anchor" href="#_5-核心模块" aria-label="Permalink to &quot;5.核心模块&quot;">​</a></h1><p><strong>在使用下面的模块时候 使用<code>nginx -V</code>检查一下是否有下面的模块 避免不生效</strong></p><h2 id="_5-1-监控-nginx-客户端的状态" tabindex="-1">5.1 监控 nginx 客户端的状态 <a class="header-anchor" href="#_5-1-监控-nginx-客户端的状态" aria-label="Permalink to &quot;5.1 监控 nginx 客户端的状态&quot;">​</a></h2><p><strong>模块名</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>--with-http_stub_status_module</span></span></code></pre></div><p><strong>语法</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># Syntax 表示语法</span></span>
<span class="line"><span># Default 表示默认值</span></span>
<span class="line"><span># Context 表示这个模块可以写在哪里 这里表示可以写在server的location中</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Syntax: stub_status on/of;</span></span>
<span class="line"><span>Default: -</span></span>
<span class="line"><span>Context: server-&gt;location</span></span></code></pre></div><p><strong>举例</strong></p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 可以在nginx.conf文件的server的location配置</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">		# 配置一个location</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">		location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> /status </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">			stub_status</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> on;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 配了一个location 然后重启一下nginx 在页面输入xxx.xxx.xxx/status</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 在页面可以看到下面的内容</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Active</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> connections: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 当前nginx正在处理活动的连接数</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># server表示名称 比如server accepts表示 服务器处理的连接数  server handled  server requests</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># accepts  总共处理的连接数</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># handled  成功创建的握手数</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># requests 总共处理的请求数</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> accepts handled requests</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 					25</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 			25</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 			23</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Reading 读取到客户端Header信息 表示正在读取客户端Header的数量是0</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Writing 正在返回给客户端Header信息</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Waiting 等待  如果开启了keep-alive 那么他的数量是 Active connections - (Reading+Writing)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Reading: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Writing: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Waiting: 1</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 这些信息的作用？</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 可以查看nginx当前的负载</span></span></code></pre></div><h2 id="_5-2-随机模块" tabindex="-1">5.2.随机模块 <a class="header-anchor" href="#_5-2-随机模块" aria-label="Permalink to &quot;5.2.随机模块&quot;">​</a></h2><p><strong>模块名</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>--with-http_random_index_module</span></span></code></pre></div><p><strong>作用</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>在给定的目录下随机显示一个页面来显示</span></span></code></pre></div><p><strong>语法</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Syntax: random_index  on/off;</span></span>
<span class="line"><span>Default: off</span></span>
<span class="line"><span>Contxt: location</span></span></code></pre></div><p><strong>例子</strong></p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 当访问xxx.xxx.xxx:8888/random的时候会随机显示/opt/app文件夹下的一个文件来显示</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    listen </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8888</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server_name </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">localhost;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  /random </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">         alias </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/opt/app;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">         random_index </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="_5-3-内容替换模块" tabindex="-1">5.3 内容替换模块 <a class="header-anchor" href="#_5-3-内容替换模块" aria-label="Permalink to &quot;5.3 内容替换模块&quot;">​</a></h2><p><strong>模块名</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>--with-http_sub_module</span></span></code></pre></div><p><strong>语法</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Syntax: sub_filter string replacement;</span></span>
<span class="line"><span>Default: --</span></span>
<span class="line"><span>Context: http、service、location</span></span></code></pre></div><p><strong>例子</strong></p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 当访问/random时 会把name 替换成jack 会把&lt;h1&gt;name&lt;/h1&gt; 替换成 &lt;h1&gt;jack&lt;/h1&gt; 返回给浏览器</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 比如现在index.html中有 name abc &lt;h1&gt;name&lt;/h1&gt;这些内容。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 那么在响应的时候会把匹配到的替换掉 返回的就是 jack abc &lt;h1&gt;jack&lt;/h1&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    listen </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8888</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server_name </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">localhost;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  /random </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">         alias </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/opt/app;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">         index </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">index.html;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">         sub_filter </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;name&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;jack&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">         sub_filter </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;h1&gt;name&lt;/h1&gt; &lt;h1&gt;jack&lt;/h1&gt;;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="_5-4-请求限制" tabindex="-1">5.4 请求限制 <a class="header-anchor" href="#_5-4-请求限制" aria-label="Permalink to &quot;5.4 请求限制&quot;">​</a></h2><p><strong>模块名</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 连接频率限制</span></span>
<span class="line"><span>--with-limit_conn_module</span></span>
<span class="line"><span># 请求频率限制</span></span>
<span class="line"><span>--with-limit_req_module</span></span></code></pre></div><h3 id="_5-4-1-ab-模块" tabindex="-1">5.4.1 ab 模块 <a class="header-anchor" href="#_5-4-1-ab-模块" aria-label="Permalink to &quot;5.4.1 ab 模块&quot;">​</a></h3><p><strong>作用</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>这是Apache的ab命令，可以模拟多线程并发请求，测试服务器负载压力，也可以测试nginx、lighthttp、IIs等其他Web服务器的压力，因为我们这个模块是限制请求的，所以需要用到ab模块来测试</span></span></code></pre></div><p><strong>安装</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>yum -y install httpd-tools</span></span></code></pre></div><p><strong>使用</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># -n 总共的请求数</span></span>
<span class="line"><span># -c 并发的请求数</span></span>
<span class="line"><span>ab -n 40 -c 20 http://127.0.0.1/</span></span></code></pre></div><h3 id="_5-4-2-共享连接内存" tabindex="-1">5.4.2.共享连接内存 <a class="header-anchor" href="#_5-4-2-共享连接内存" aria-label="Permalink to &quot;5.4.2.共享连接内存&quot;">​</a></h3><p><strong>要想使用请求限制 需要先分配一个共享内存</strong></p><p>nginx 有一个 master 进程和 n(一般根据 cpu 核数)个 worker 进程，一个客户端(IP)给服务器发请求，会随机分配给一个 worker</p><p>我们可以这么做 ，在内存中开辟一块空间，这个空间会对所有的 worker 进行内存共享，这里面存放着所有的限制连接的数据，比如我们限制每秒钟每个 IP 只能连接一次，现在有一个 IP 给服务器发请求，这时候会分配到一个 worker，这个 worker 就会往这个共享内存中写入一条数据 比如 ip 地址为 xxx 的 在 14:30:22 的时候发起了一个请求，建立了一次连接等信息，如此同时这个 ip 又发送了一个请求到这个服务器，被别的 worker 来处理了，这时候这个 worker 会先去共享空间查询一下是否存在限制，这时候正好有一条这个 ip 发的请求时间是在 1 秒内，那么这时候就不符合我们设置的 1s 内 1 一个 IP 只能发送 1 次请求，所以就会断开这次连接</p><p><strong>语法</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># key：我们可以以请求的IP为key  zone：空间的名词 size：为空间申请的大小</span></span>
<span class="line"><span># 说白了key就是worker过来找的时候能够比对的标识符 用请求的IP为key</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Syntax: limit_conn_zone key zone=name:size</span></span>
<span class="line"><span>Default: --</span></span>
<span class="line"><span>Context: http(定义在server以外)</span></span></code></pre></div><p><strong>举例</strong></p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # $binary_remote_addr 是nginx的变量 表示请求的客户端的IP地址</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 这段表示 key是客户端IP 空间的名称是conn_zone(自定义的)大小是10m</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  limit_conn_zone </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$binary_remote_addr zone=conn_zone:10m;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  server: {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    xxx</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="_5-4-3-连接限制" tabindex="-1">5.4.3 连接限制 <a class="header-anchor" href="#_5-4-3-连接限制" aria-label="Permalink to &quot;5.4.3 连接限制&quot;">​</a></h3><p><strong>语法</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># zone表示共享空间的名称 number：限制数量(每个客户端每秒同时连接的数量)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Syntax: limit_conn zone number</span></span>
<span class="line"><span>Default: --</span></span>
<span class="line"><span>Context: http、server、location</span></span></code></pre></div><p><strong>附加属性</strong></p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 断开连接的返回的状态码 默认503</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> limit_conn_status </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">500</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 断开连接日志的等级 info|notice|warn|error</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> limit_conn_log_level </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">warn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 每秒服务器只能给客户端发送50字节</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> limit_rate </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">50</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><p><strong>举例</strong></p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 创建共享空间</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  limit_conn_zone </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$binary_remote_addr zone=conn_zone:10m;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> /zone </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        alias </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/opt/app;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        index </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">blue.html;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      	# 共享空间是conn_zone 每秒钟同一个IP只能发起一个连接</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      	# 这里需要注意的是 一个连接可以发无数个请求</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      	# 虽然我们这里限制了1个连接。我们用ab测试的时候假如并发设置10 总的请求设置成10。可能10个请求都成功了 也肯只有一个请求成功 原因就是可能这10个请求都走的这个连接</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        limit_conn </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">conn_zone </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 断开连接的返回的状态码 默认503</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        limit_conn_status </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">500</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 断开连接日志的等级</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        limit_conn_log_level </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">warn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 每秒服务器只能给客户端发送50字节</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        limit_rate </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">50</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="_5-4-4-请求限制" tabindex="-1">5.4.4 请求限制 <a class="header-anchor" href="#_5-4-4-请求限制" aria-label="Permalink to &quot;5.4.4 请求限制&quot;">​</a></h3><p><strong>注意:</strong> limit_req 生效是在 limit_conn 之前</p><p><strong>定义共享内存 语法</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 因为请求限制的原理是依靠共享内存的 解释参考上面的共享连接内存</span></span>
<span class="line"><span># 所以要配置一下共享内存</span></span>
<span class="line"><span># key 一般使用客户端ip  zone 自定义名称 size 大小 rate 速率</span></span>
<span class="line"><span>Syntax: limit_req_zone key zone=name:size rate=rate</span></span>
<span class="line"><span>Default:--</span></span>
<span class="line"><span>Context: http(定义在server以外)</span></span></code></pre></div><p><strong>请求限制 语法</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># zone 共享内存名称</span></span>
<span class="line"><span># burst 下面具体讲解  nodelay 下面具体讲解</span></span>
<span class="line"><span>Syntax: limit_req zone=name [burst=number] [nodelay]</span></span>
<span class="line"><span>Default: --</span></span>
<span class="line"><span>Context: http,server,location</span></span></code></pre></div><p><strong>案例</strong></p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 定义了共享空间 key是IP地址。名称是req_zone 内存10m。每秒只能响应一条数据</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">limit_req_zone </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$binary_remote_addr zone=req_zone:10m rate=1r/s;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 使用 ab -n 10 -c http://127.0.0.1/8888/req</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 总请求数是10条 并发是1条</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 我测试的是不到1s就发送了这个10条请求 所以成功的请求只有1条 失败了9条</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 因为我们设置了每秒只能响应一条数据</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    listen </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8888</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server_name </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">localhost;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> /req </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        alias </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/opt/app;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        index </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">blue.html;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        limit_req </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">zone=req_zone;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="_5-4-5-burst-参数" tabindex="-1">5.4.5 burst 参数 <a class="header-anchor" href="#_5-4-5-burst-参数" aria-label="Permalink to &quot;5.4.5 burst 参数&quot;">​</a></h3><p>burst 是干嘛的呢 看下面详细的讲解</p><p>limit_req 使用的是漏斗算法 什么是漏斗算法算法呢，下面举一个例子</p><p>现在有一个水龙头 🚰，我们来接水，假设我们限制每秒只能接一滴水，这时候水龙头每秒就滴一滴水，也符合我们的限制，但是这时候水龙头每秒滴 10 滴水了，那么明显不符合我们的需求了，每秒多余的 9 滴水我们只能抛弃了</p><p>现在我们换一种方法 我们在水龙头下面放一个漏斗(桶、盆都行) 这个漏斗每秒固定的只能流出一滴水 他的容量是 5 滴 下面我们分解一下 这 10 滴水怎么处理的</p><p><strong>注意</strong></p><p>在描述事件或者过程的时间线时，以“第 0 秒”开始是一种常见的方式，用来表示从某个特定动作发起的初始时刻。这并不是说真正存在一个零长度的第 0 秒，而是为了方便计算和解释，在时间序列的起点指定为第 0 秒。</p><ul><li>第 0 秒的时候 来了 10 滴 然后每秒只能处理 1 滴，当前没有正在处理的，所以会处理 1 滴, 剩余 9 滴 因为漏斗的容量是 5 所以这 9 滴只有 5 滴进入漏斗</li><li>第 1 秒 漏斗流出一滴 还剩 4 滴</li><li>第 2 秒 漏斗流出一滴 还剩 3 滴</li><li>第 3 秒 漏斗流出一滴 还剩 2 滴</li><li>第 4 秒 漏斗流出一滴 还剩 1 滴</li><li>第 5 秒 漏斗流出一滴 还剩 0 滴</li><li>所以用时 5 秒 一共处理了 6 滴</li></ul><p>水龙头其实就代表了客户端(浏览器)，因为我们无法控制浏览器每秒的请求数量，可能当前浏览器发起了 10 条请求，每秒请求一次，也可能每秒请求 5 次那么两秒就请求完毕了，或者说 1 秒就请求 10 次</p><p>虽然我们无法控制客户端 但是我们可以控制漏斗的恒定流速 那么 burst 其实就是充当漏斗 我们可以设定这个漏斗可以缓存多少数据</p><p><strong>案例</strong></p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 定义了共享空间 key是IP地址。名称是req_zone 内存10m。每秒只能响应一条数据</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">limit_req_zone </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$binary_remote_addr zone=req_zone:10m rate=1r/s;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> /req </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        alias </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/opt/app;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        index </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">blue.html;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        limit_req </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">zone=req_zone burst=5;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="_5-4-6-nodelay-参数" tabindex="-1">5.4.6 nodelay 参数 <a class="header-anchor" href="#_5-4-6-nodelay-参数" aria-label="Permalink to &quot;5.4.6 nodelay 参数&quot;">​</a></h3><p>上面 burst 案例我们说到 浏览器一次发送了 10 条请求 ，然后成功响应了 6 条 耗费 5s 中 但是让用户等待 5s 是不好的行为</p><p>如果设置了 nodelay，则即使请求暂时超出了每秒允许的频率，只要总数没有超过 burst 大小，这些请求也会立即得到处理，而不会被延迟。开启 nodelay 后，服务器会立刻处理 burst 内所有的请求，然后恢复正常的速率控制。</p><p><strong>案例</strong></p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 定义了共享空间 key是IP地址。名称是req_zone 内存10m。每秒只能响应一条数据</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">limit_req_zone </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$binary_remote_addr zone=req_zone:10m rate=1r/s;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> /req </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        alias </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/opt/app;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        index </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">blue.html;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        limit_req </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">zone=req_zone burst=5 nodelay;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>结合案例 我们设置了 nodelay 然后浏览器并发了 10 个请求</p><p>第一个请求立即被处理，随后的请求直到数量达 到 burst 值的限制都将立即获得处理，而不必等待。也就是说，如果同时到达 5 个请求，在开启了 nodelay 的情况下，这 5 个请求几乎会同时被处理。之后服务器将恢复到每秒处理一个请求的速率。</p><p>这样客户端就不用等待了 可以立马获取结果</p><h2 id="_5-5-访问控制" tabindex="-1">5.5 访问控制 <a class="header-anchor" href="#_5-5-访问控制" aria-label="Permalink to &quot;5.5 访问控制&quot;">​</a></h2><h3 id="_5-5-1-基于-ip-地址的访问控制" tabindex="-1">5.5.1 基于 Ip 地址的访问控制 <a class="header-anchor" href="#_5-5-1-基于-ip-地址的访问控制" aria-label="Permalink to &quot;5.5.1 基于 Ip 地址的访问控制&quot;">​</a></h3><p><strong>模块名</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>http_access_moudle</span></span></code></pre></div><p><strong>作用</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>可以设置允许访问的ip。也可以设置不允许访问的ip。有两种写法</span></span></code></pre></div><p><strong>语法(allow)</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 值可以是 IP地址 或者 all</span></span>
<span class="line"><span># 这个表示允许哪些可以访问</span></span>
<span class="line"><span>Syntax: allow address|all</span></span>
<span class="line"><span>Default: --</span></span>
<span class="line"><span>Context: http,server.location.limit_except</span></span></code></pre></div><p><strong>语法(deny)</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 值可以是 IP地址 或者 all 或者 CIDR</span></span>
<span class="line"><span># 这个表示不允许哪个访问 也就是除了设置的地址其余的都能访问</span></span>
<span class="line"><span>Syntax: deny address|CIDR|all</span></span>
<span class="line"><span>Default: --</span></span>
<span class="line"><span>Context: http,server.location.limit_except</span></span></code></pre></div><p><strong>案例</strong></p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> /admin </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      alias </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/opt/app;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      # 表示只要是这个ip访问/admin 都不允许访问</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      deny </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">119.120.221.100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      # 可以设置多个ip</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      deny </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">119.120.221.101</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      # 可以和allow同时使用</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      allow </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">119.120.221.101</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> /admin1 </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      alias </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/opt/app;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      # 表示只允许这个ip访问/admin1 其余ip地址访问/admin1都被拒绝</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      allow </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">119.120.221.100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      # 可以设置多个ip</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      allow </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">119.120.221.101</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h1 id="_6-静态资源-web-服务器" tabindex="-1">6 静态资源 web 服务器 <a class="header-anchor" href="#_6-静态资源-web-服务器" aria-label="Permalink to &quot;6 静态资源 web 服务器&quot;">​</a></h1><h2 id="_6-1-静态资源和动态资源" tabindex="-1">6.1 静态资源和动态资源 <a class="header-anchor" href="#_6-1-静态资源和动态资源" aria-label="Permalink to &quot;6.1 静态资源和动态资源&quot;">​</a></h2><ul><li><strong>静态资源</strong>：一般客户端发送请求到 web 服务器，web 服务器从内存再取到相应的文件，返回给客户端，客户端解析并渲染出来</li></ul><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 比如我想访问某个图片 那么直接会从文件夹去拿，这就是静态资源</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">     location</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ~</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> .*\.(jpg|jpeg|png|gif) </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            root </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/usr/share/nginx/html;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><ul><li><strong>动态资源</strong>：一般客户端请求的动态资源，现将请求将于 web 容器，web 容器连接数据库，数据库处理数据之后，将内容交给 web 服务器，web 服务器返回给客户端解析渲染处理</li></ul><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 现在所有的api开头的请求都会被代理到http://localhost:3000 这就是动态资源</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    location</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ~</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> ^/api </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            rewrite</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> ^/api/(.*) /$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">break</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            proxy_pass </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> http://localhost:3000;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="_6-2-cdn" tabindex="-1">6.2 CDN <a class="header-anchor" href="#_6-2-cdn" aria-label="Permalink to &quot;6.2 CDN&quot;">​</a></h2><ul><li><p>CDN 全称是 Content Delivery Network，即内容分发网络</p></li><li><p>CDN 系统能够实时的根据网络流量和各节点的连接、负载状况以及到用户的距离和响应时间等综合信息将用户的请求重新导向离用户最近的服务器节点上。其目的是使用户可以就近去的所需内容，解决网络拥挤的状况，提高用户访问房展的响应速度。</p></li><li><p>如果想要把 nginx 作为 CDN 服务器可以做以下的优化配置，不做也无所谓</p></li></ul><p><strong>语法</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 不经过用户内核发送文件</span></span>
<span class="line"><span>Syntax: sendfile on/off</span></span>
<span class="line"><span>Default: off</span></span>
<span class="line"><span>Context: http、server、location、if in location</span></span></code></pre></div><p><strong>案例</strong></p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"></span></code></pre></div><h2 id="_6-3-tcp-nopush-和-tcp-nodelay" tabindex="-1">6.3 tcp_nopush 和 tcp_nodelay <a class="header-anchor" href="#_6-3-tcp-nopush-和-tcp-nodelay" aria-label="Permalink to &quot;6.3 tcp_nopush 和 tcp_nodelay&quot;">​</a></h2><p><strong>tcp_nopush</strong></p><ul><li>在开启 sendfile 的情况下，会合并多个数据包，提高网络包的传输效率</li><li>假如我们现在在下载电影，每秒都会响应数据 这时候开启这个就会合并多个响应 比如每 3 秒响应一次</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Syntax: tcp_nopush on/off</span></span>
<span class="line"><span>Default: off</span></span>
<span class="line"><span>Context: http、server、location</span></span></code></pre></div><p><strong>tcp_nodelay</strong></p><ul><li>在 keepalive 连接下，提高网络包的实时传输性</li><li>假如现在每秒响应一个数据，那么 nginx 会立刻响应，一般用于需要实时传输数据的情况，比如游戏数据</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Syntax: tcp_nodelay on/off</span></span>
<span class="line"><span>Default: on</span></span>
<span class="line"><span>Context: http、server、location</span></span></code></pre></div><h2 id="_6-4-gzip" tabindex="-1">6.4 gzip <a class="header-anchor" href="#_6-4-gzip" aria-label="Permalink to &quot;6.4 gzip&quot;">​</a></h2><p><strong>gzip</strong></p><ul><li>控制 gzip 压缩率的</li><li>压缩比率越高，文件被压缩的体积越小，对应的加载资源的速度就越慢</li><li>1-9 级别</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Syntax: gzip on/off</span></span>
<span class="line"><span>Default: off</span></span>
<span class="line"><span>Context: http、server、location</span></span></code></pre></div><p><strong>gzip_comp_level</strong></p><ul><li>控制 gzip 压缩率的</li><li>压缩比率越高，文件被压缩的体积越小，对应的加载资源的速度就越慢</li><li>1-9 级别</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Syntax: gzip_comp_level level</span></span>
<span class="line"><span>Default: 1</span></span>
<span class="line"><span>Context: http、server、location</span></span></code></pre></div><p><strong>gzip_http_version</strong></p><ul><li>用于识别 http 协议的版本，早期的浏览器不支持 gzip 压缩，用户会看到乱码，所以为了支持前期版本加了此选项。默认在 http/1.0 的协议下不开启 gzip 压缩。</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Syntax: gzip_http_version 1.0/1.1</span></span>
<span class="line"><span>Default: gzip_http_version 1.1</span></span>
<span class="line"><span>Context: http、server、location</span></span></code></pre></div><p><strong>http_gzip-static_module</strong></p><ul><li>如果我们每次都在 nginx 中进行 gzip 压缩，那么假如现在并发 1000 个请求那么就要执行 1000 次 gzip，性能肯定是不高的</li><li>如果启用了这个模块，就会先在文件夹中找到同名的<code>gz</code>文件是否存在</li><li>比如现在有接口来找 a.txt,那么 nginx 会先将 a.txt 压缩(不会动原文件)然后才返回，现在我们直接将 a.txt 压缩成<code>a.txt.gz</code>，当请求过来 会先找<code>a.txt.gz</code>文件，然后直接返回</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Syntax: gzip_static on/off</span></span>
<span class="line"><span>Default: off</span></span>
<span class="line"><span>Context: http、server、location</span></span></code></pre></div><p><strong>案例</strong></p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      # 图片就不开启gzip压缩了 因为本身图片就是被压缩过的</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        location</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ~</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> .*\.(jpg|jpeg|png|gif) </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            gzip </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">off</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            root </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/usr/share/nginx/html;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        location</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ~</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> .*\.(html|js|css) </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            gzip </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      			# 当返回内容大于此值时才会使用gzip进行压缩,以K为单位,当值为0时，所有页面都进行压缩。</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            gzip_min_length </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1k</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            gzip_http_version </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            gzip_comp_level </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  9</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            #设置需要压缩的MIME类型,如果不在设置类型范围内的请求不进行压缩</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            gzip_types </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">text/css application/javascript;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            root </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/usr/share/nginx/html;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        location</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ~</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> ^/download </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">           gzip_static </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">           tcp_nopush </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">           root </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/usr/share/nginx/html;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h1 id="_7-浏览器缓存" tabindex="-1">7 浏览器缓存 <a class="header-anchor" href="#_7-浏览器缓存" aria-label="Permalink to &quot;7 浏览器缓存&quot;">​</a></h1><p>nginx 天生就支持浏览器缓存策略，也就是响应的时候会携带 etag 和 last-modified 字段，所以不用做任何配置</p><p><a href="https://excalidraw.com/#json=Pp460J3hFs7VN19GFMzqz,IB7-UgLaR8RzbbEsl0IfaA" target="_blank" rel="noreferrer">浏览器缓存</a></p><p>唯一需要配置的就是过期时间</p><h2 id="_7-1-expires" tabindex="-1">7.1 expires <a class="header-anchor" href="#_7-1-expires" aria-label="Permalink to &quot;7.1 expires&quot;">​</a></h2><p>注意如果设置了 expires 就相当于使用强制缓存了</p><p><strong>作用</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>添加Cache-Control、Expires头</span></span></code></pre></div><p><strong>语法</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Syntax: expires time</span></span>
<span class="line"><span>Default: off</span></span>
<span class="line"><span>Context: http、server、location</span></span></code></pre></div><p><strong>案例</strong></p><ul><li>理论上设置了 expires，当时间没过期，那么当我再次请求这个图片的时候就不会想服务器发送请求，而是直接使用缓存</li><li>但是因为浏览器的差异，如果使用的是 chrome 那么即使设置了 expires，没有过期，还是会发送请求，IE 不会发送可以试一下</li><li>如果使用的是 img 标签 src 等于这种图片，那么 chrome 就不会向服务器发送请求，而是直接使用缓存，这个请求的 status 是(200 OK (from memory cache))</li></ul><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      location</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ~</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> .*\.(jpg|jpeg|png|gif) </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      		# 过期时间24小时</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">          expires </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">24h</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">          root </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/usr/share/nginx/html;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h1 id="_8-跨域" tabindex="-1">8 跨域 <a class="header-anchor" href="#_8-跨域" aria-label="Permalink to &quot;8 跨域&quot;">​</a></h1><p>解决跨域其实原理就是添加一个响应头</p><p><strong>语法</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Syntax: add_header name value</span></span>
<span class="line"><span>Default: --</span></span>
<span class="line"><span>Context: http、server、location</span></span></code></pre></div><p><strong>案例</strong></p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">     location</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ~</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> ^/api </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      			# 添加一个响应头 允许所有源</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            add_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Access-Control-Allow-Origin *;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            # 添加一个响应头 允许的方法是什么</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            add_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Access-Control-Allow-Methods GET,POST;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            rewrite</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> ^/api/(.*) /$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">break</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            proxy_pass </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> http://localhost:3000;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h1 id="_9-防盗链" tabindex="-1">9 防盗链 <a class="header-anchor" href="#_9-防盗链" aria-label="Permalink to &quot;9 防盗链&quot;">​</a></h1><ul><li>防止网站资源被盗用</li><li>保证信息安全</li><li>防止流量过量</li><li>区别哪些请求是非正常的请求</li></ul><p><strong>什么是</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>比如现在a网站有一个图片，在没有设置防盗链的情况下 任何网站拿到这个图片的url都可以显示，但是这有一个问题，比如现在b网站显示的全部是a网站的图片的，那么b网站就不用在服务器里存储图片了，直接使用a网站的链接即可，这肯定是不允许的  所以我们可以设置防盗链 设置允许哪些网站可以访问我们服务器的资源，那些不被允许的网站想要链接我们网站的资源就会报错304(没权限)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>原理</span></span>
<span class="line"><span>当浏览器发起请求时会在requestHeader中携带Referer字段  那么nginx就是通过这个字段的值和我们设置允许访问的值做比对，进而判断是否有权限</span></span>
<span class="line"><span></span></span>
<span class="line"><span>注意 当直接在浏览器输入资源地址请求头中是没有Referer的 所以配置的时候要是不允许浏览器地址栏访问 就不要在规则中设置none</span></span></code></pre></div><p><strong>语法</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># server_names、IP是必填的 none、block可以不存在</span></span>
<span class="line"><span>Syntax: valid_referers none、block、server_names、IP</span></span>
<span class="line"><span>Default: --</span></span>
<span class="line"><span>Context: server、location</span></span></code></pre></div><p><strong>案例</strong></p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">     location</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ~</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> .*\.(jpg|jpeg|png|gif) </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      			# 配置允许访问的地址。当none(请求头没有referer或者值是空) 或者 bolcked 或者192.168.1.112地址</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            valid_referers </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">none blocked </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">192.168.1.112</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      			# 如果不是允许的地址 返回403</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            # $invalid_referer系统自带的变量 可以捕获到valid_referers之外的内容</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ($invalid_referer) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 403</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            root </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/usr/share/nginx/html;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h1 id="_10-代理服务" tabindex="-1">10 代理服务 <a class="header-anchor" href="#_10-代理服务" aria-label="Permalink to &quot;10 代理服务&quot;">​</a></h1><p><strong>代理服务分成正向代理和反向代理</strong></p><p><strong>语法</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Syntax: proxy_pass URL</span></span>
<span class="line"><span>Default: --</span></span>
<span class="line"><span>Context: server、location</span></span></code></pre></div><h2 id="_10-1-正向代理" tabindex="-1">10.1 正向代理 <a class="header-anchor" href="#_10-1-正向代理" aria-label="Permalink to &quot;10.1 正向代理&quot;">​</a></h2><ul><li>正向代理的对象是客户端，服务端看不到真正的客户端</li></ul><p><strong>案例</strong></p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 假如www.jetli.com.cn我们现在的网络访问不了</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 然后我们就可以让nginx进行代理 进而访问该网站</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 这里要注意 要修改本地的hosts文件要让www.jetli.com.cn域名指向我们的服务器</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 不然我们的服务器拦截 不了</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   # chrome的域名解析地址 一定要写不然输入域名解析不了</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">   resolver </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8.8.8.8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    listen </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 7777</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 这里一定要配置想要访问的域名 不然进不来nginx</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server_name </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">localhost www.jetli.com.cn;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> / </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      # $http_host 请求的主机名</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      # $request_uri  请求路径</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      # 假如我们在地址栏请求 www.jetli.com.cn/abc</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      # 那么$http_host就是 www.jetli.com.cn</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      # $request_uri就是/abc</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       proxy_pass </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">http://$http_host$request_uri;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 我们还可以使用正向代理 代理外网</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 比如我们有一个香港的服务器</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 然后做如下配置</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 然后当访问7777端口就会代理到yutube了</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    listen </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 7777</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server_name </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">localhost;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> / </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       proxy_pass </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">http://www.yutube.com;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="_10-2-反向代理" tabindex="-1">10.2 反向代理 <a class="header-anchor" href="#_10-2-反向代理" aria-label="Permalink to &quot;10.2 反向代理&quot;">​</a></h2><ul><li>反省代理的对象是服务端，客户端看不到真正的服务端</li></ul><p><strong>案例</strong></p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    location</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ~</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> ^/api </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            rewrite</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> ^/api/(.*) /$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">break</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            # 设置正向代理</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      			# 客户端本来想访问http://localhost:3000</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      			# 但是实际上访问的是nginx 然后nginx去访问3000端口 然后结果给到客户端</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            proxy_pass </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> http://localhost:3000;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            # 向代理的服务器传递头信息</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      			proxy_set_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Host $http_host;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            proxy_set_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">X-Real-Ip $remote_addr;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            proxy_connect_timeout </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">30</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 默认超时时间 单位s</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            proxy_send_timeout </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">60</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 请求代理服务器 代理服务器响应的超时时间</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            proxy_read_timeout </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">60</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 读取代理服务器的响应 比如60s还没读取完毕 也算超时</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="_10-3-proxy-pass" tabindex="-1">10.3 proxy_pass <a class="header-anchor" href="#_10-3-proxy-pass" aria-label="Permalink to &quot;10.3 proxy_pass&quot;">​</a></h2><ul><li><p>为了方便记忆和规范配置，建议所有的<code>proxy_pass</code>后的 url 都以<code>/</code>结尾</p></li><li><p><code>proxy_pass</code>后的 url 最后加上<code>/</code>就是绝对根路径，<code>location</code>中匹配到的路径会被替换掉</p></li></ul><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 请求的地址是 http://www.example.com/a/text.html</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 然后就会代理到 http://127.0.0.1/b/text.html</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># /a/被替换掉了	直接走代理的路径了</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 请求的地址是 http://www.example.com/a/</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 然后就会代理到 http://127.0.0.1/b/</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> /a/ </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      proxy_pass </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">http://127.0.0.1/b/;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><ul><li><code>proxy_pass</code>后的 url 最后不加上<code>/</code>就是绝对根路径，<code>location</code>中匹配到的路径会保留</li></ul><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 请求的地址是 http://www.example.com/a/text.html</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 然后就会代理到 http://127.0.0.1/a/text.html</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># /a/没有被替换掉</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> /a/ </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      proxy_pass </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">http://127.0.0.1;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><ul><li>在<code>proxy_pass</code>前面用了<code>rewrite</code>，这种情况下 <code>proxy_pass</code>是无效的</li></ul><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 这种情况下proxy_pass无效</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> /a/ </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      rewrite</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /a/ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">break</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      proxy_pass </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">http://127.0.0.1;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h1 id="_11-负载均衡" tabindex="-1">11 负载均衡 <a class="header-anchor" href="#_11-负载均衡" aria-label="Permalink to &quot;11 负载均衡&quot;">​</a></h1><ul><li>使用集群是网站解决高并发、海亮数据的常见手段</li><li>当一台服务器的处理能力、存储空间不足时，不要企图去换更强大的服务器，对大型网站而言，不管多么强大的服务器，都满足不了网站持续增长的业务需求</li><li>这种情况下，更恰当的做法是增加一台服务器分担原有服务器的访问及存储压力。通过负载均衡调度服务器，将来自浏览器的访请求分发到应用服务器集群中的任何一台服务器上，如果有更多的用户，就在集群中加入更多的应用服务器，使应用服务器的负载压力不再成为整个网站的瓶颈</li></ul><p><strong>负载均衡本质上其实就是一个资源池，当请求进来了，nginx 默认通过轮询资源池分配请求</strong></p><p><strong>语法</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Syntax: upstream name {}</span></span>
<span class="line"><span>Default: --</span></span>
<span class="line"><span>Context: http</span></span></code></pre></div><p><strong>案例</strong></p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 注意资源池的位置是在http中 不在server或location中</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 这些服务模拟本地的 开发中可以对应到不同的服务器地址</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># cym是自定义资源池名称</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">upstream</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> cym </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 127.0.0.1:3000;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 127.0.0.1:4000;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 127.0.0.1:5000;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  listen </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">7001</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  server_name </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">localhost;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> / </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 当匹配到请求 就代理到cym资源池中</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    proxy_pass </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">http://cym;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="_11-1-后端服务器调试状态" tabindex="-1">11.1 后端服务器调试状态 <a class="header-anchor" href="#_11-1-后端服务器调试状态" aria-label="Permalink to &quot;11.1 后端服务器调试状态&quot;">​</a></h2><table tabindex="0"><thead><tr><th>状态</th><th>描述</th></tr></thead><tbody><tr><td>down</td><td>当前服务器不参与负载均衡，也就是说请求不会被分配给这个服务器</td></tr><tr><td>backup</td><td>当资源池其他的服务器都无法使用的时候 才会使用这个服务器</td></tr><tr><td>max_fails</td><td>允许请求失败的次数，到达最大次数就会休眠。eg：比如有一个服务器配置了这个属性，次数 2，那么假如这个服务器挂了也会请求 请求 2 次之后依然没响应 就会休眠，休眠时间看 fail_timeout</td></tr><tr><td>fail_timeout</td><td>经过 max_fails 失败后，服务器暂停的时间，默认 10s</td></tr><tr><td>max_conns</td><td>限制每个 server 最大的接收的连接数，性能高的服务器可以连接多一些</td></tr></tbody></table><p><strong>举例</strong></p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 这些值 每个服务器可以设置也可以不设置</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">upstream</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> cym </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 127.0.0.1:3000 down;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 127.0.0.1:4000 backup;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 127.0.0.1:5000;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  listen </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">7001</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  server_name </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">localhost;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> / </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    proxy_pass </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">http://cym;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="_11-2-分配方式" tabindex="-1">11.2 分配方式 <a class="header-anchor" href="#_11-2-分配方式" aria-label="Permalink to &quot;11.2 分配方式&quot;">​</a></h2><ul><li>上面说到 分配服务器的方式默认是轮询，下面是不同的分配方式</li></ul><table tabindex="0"><thead><tr><th>类型</th><th>含义</th></tr></thead><tbody><tr><td>轮询(默认)</td><td>每个请求按时间顺序逐一分配到不同的后端服务器，如果后端服务器 down 掉，能自动剔除</td></tr><tr><td>weight(加权轮询)</td><td>指定权重，权重越高分配到的几率越大</td></tr><tr><td>ip_hash</td><td>每个请求按照 ip 的 hash 结果分配，这样如果是同一个 ip 的请求就分配给之前分配到的服务器，不用分配新的服务器</td></tr><tr><td>least_conn</td><td>哪个机器上的连接数少就分配给谁</td></tr><tr><td>url_hash(三方，需要安装对应模块)</td><td>按访问的 url 地址 hash 来分配，就是说如果访问的 url 地址相同的话就会分配到同一个服务器上</td></tr><tr><td>fair(三方的，需要安装对应模块)</td><td>按照后端服务器的响应时间来分配请求，响应时间短的优先分配</td></tr><tr><td>自定义 hash</td><td>hash 自定义 key</td></tr></tbody></table><p><strong>举例</strong></p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 这些值 每个服务器可以设置也可以不设置</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">upstream</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> cym </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  ip_hash</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 127.0.0.1:3000;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">upstream</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> cym1 </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  least_conn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 127.0.0.1:3000;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">upstream</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> cym2 </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 127.0.0.1:3000 </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">weight</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  server 127.0.0.1:4000 </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">weight</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  server 127.0.0.1:5000;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  listen </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">7001</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  server_name </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">localhost;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> / </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    proxy_pass </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">http://cym;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h1 id="_12-日志" tabindex="-1">12 日志 <a class="header-anchor" href="#_12-日志" aria-label="Permalink to &quot;12 日志&quot;">​</a></h1><h2 id="_12-1-日志类型" tabindex="-1">12.1 日志类型 <a class="header-anchor" href="#_12-1-日志类型" aria-label="Permalink to &quot;12.1 日志类型&quot;">​</a></h2><ul><li>访问日志 /var/log/nginx/accsess.log</li><li>错误日志 /var/log/nginx/error.log</li></ul><p><strong>语法</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Synatx: log_format name [escape=default[json] string]</span></span>
<span class="line"><span>Default: log_format combined &#39;&#39;</span></span>
<span class="line"><span>Context: http</span></span></code></pre></div><h2 id="_12-2-内置变量" tabindex="-1">12.2 内置变量 <a class="header-anchor" href="#_12-2-内置变量" aria-label="Permalink to &quot;12.2 内置变量&quot;">​</a></h2><ul><li>下面是部分常用的，具体的看官网</li></ul><table tabindex="0"><thead><tr><th>名称</th><th>含义</th></tr></thead><tbody><tr><td>$remote_addr</td><td>客户端地址</td></tr><tr><td>$remote_user</td><td>客户端用户名称</td></tr><tr><td>$time_local</td><td>访问时间和时区</td></tr><tr><td>$request</td><td>请求行</td></tr><tr><td>$status</td><td>HTTP 请求状态</td></tr><tr><td>$body_bytes_sent</td><td>发送给客户端文件的内容大小</td></tr></tbody></table><h2 id="_12-3-http-请求变量" tabindex="-1">12.3 http 请求变量 <a class="header-anchor" href="#_12-3-http-请求变量" aria-label="Permalink to &quot;12.3 http 请求变量&quot;">​</a></h2><ul><li>注意要把请求头中的<code>-</code>转为<code>_</code>，比如 User-Anget 对应<code>$http_user_agent</code></li><li>比如想要查看请求头的<code>Accept-Language</code> 只要这样即可 <code>$http_Accept_Language</code></li></ul><table tabindex="0"><thead><tr><th>名称</th><th>含义</th><th>举例</th></tr></thead><tbody><tr><td>arg_PARAMETER</td><td>请求的参数</td><td>$arg_name 查看 key 是 name 的参数</td></tr><tr><td>http_HEADER</td><td>请求头</td><td>$http_referer</td></tr><tr><td>sent_http_HEADER</td><td>响应头</td><td>sent_http_cookie</td></tr></tbody></table><p><strong>FAQ</strong> 比如现在有一个 ip 是通过代理来访问的，怎么可以获取源头的 IP 呢</p><p>可以通过<code>$http_x_forwarded_for</code>, 他会获取到代理过程</p><p>比如： IP1&gt;IP2(代理)-&gt;IP3 IP1 通过 IP2 代理到 IP3 这个时候$http_x_forwarded_for=IP，proxy(1),Proxy(2) IP</p><h1 id="_13-location" tabindex="-1">13 location <a class="header-anchor" href="#_13-location" aria-label="Permalink to &quot;13 location&quot;">​</a></h1><h2 id="_13-1-语法规则" tabindex="-1">13.1 语法规则 <a class="header-anchor" href="#_13-1-语法规则" aria-label="Permalink to &quot;13.1 语法规则&quot;">​</a></h2><ul><li>location 仅匹配 URL，忽略参数 <ul><li>访问/a?name=zs 只会匹配/a 不会匹配/a?name=zs</li></ul></li><li><strong>前缀字符串匹配有以下 3 种</strong><ul><li>常规匹配</li><li>=精确匹配</li><li>^~匹配上后则不会进行正则匹配 <code>这里的^表示取反的意思</code></li></ul></li><li><strong>正则匹配</strong><ul><li>~大小写敏感的正则表达式匹配</li><li>~*忽略大小写的正则表达式匹配</li></ul></li><li><strong>内部跳转</strong><ul><li>用于内部跳转的命名 location @</li></ul></li></ul><p><strong>语法</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Synatx: location [=|~|~*|^~] uri {...}</span></span>
<span class="line"><span>Default: -</span></span>
<span class="line"><span>Context: server,location</span></span></code></pre></div><p><strong>案例</strong></p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     # 精确匹配 路径必须是/cym</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        location</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> /cym </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 200</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;精确匹配cym&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 常规匹配 匹配的是/api前缀</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> /api </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 200</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;常规匹配 匹配/api开头的&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 忽略正则的匹配</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 如果匹配到这个 后面有个location是 ~ /user</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 那么会使用这个 而不使用正则的匹配</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        location</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ^~</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> /user </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 200</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;忽略正则匹配&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 正则匹配 区分大小写 匹配 /post/数字</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 使用 ～ 开头</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        location</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ~</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> /post/(\d+) </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 200</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;正则匹配 区分大小写  $</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 正则匹配 不区分大小写</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # /Link/1  /LiNk/1 这样都能匹配到</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 使用 ～* 开头</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        location</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ~*</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> /LINK/(\d+) </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 200</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;正则匹配 不区分大小写  $</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="_13-2-匹配规则" tabindex="-1">13.2 匹配规则 <a class="header-anchor" href="#_13-2-匹配规则" aria-label="Permalink to &quot;13.2 匹配规则&quot;">​</a></h2><p><strong>优先级按照顺序</strong></p><ol><li>等号类型(=)的优先级最高，一旦匹配成功，则不在查找其他匹配项</li><li>^~类型表达式，一旦匹配成功，则不在查找其他匹配项</li><li>正则表达式类型(~,~*)的优先级次之，如果多个 location 的正则匹配的话，则使用表达式最长的那个</li><li>常规字符串类型按前缀匹配</li></ol><p><strong>案例</strong></p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       location</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ~</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> /T1/\d+ </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{ </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 编号1</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 200</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;cym&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        location</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ~</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> /T1/\d+/a </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{ </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 编号2</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 200</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;kkkk&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> /a </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{ </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 编号3</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 200</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;字符串匹配&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> /a/b/c </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{ </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 编号4</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 200</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;最长字符串&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># FQA</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Q：输入http://localhost/T1/2/a 会走哪个location</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># A：编号1。 想法上会是编号2,因为路径完全符合编号2 因为顺序不同，正则匹配会按照顺序优先匹配</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Q：输入http://localhost/a/b/c/d 会走哪个location</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># A：编号4。 想法上会是编号3, 因为路径匹配/a前缀了，但是匹配前缀规则是按照最长表达式来匹配的 因为/a/b/c/d 符合 location /a/b/c</span></span></code></pre></div><h1 id="_14-rewrite" tabindex="-1">14 rewrite <a class="header-anchor" href="#_14-rewrite" aria-label="Permalink to &quot;14 rewrite&quot;">​</a></h1><p><strong>语法</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># flag:用来设置rewrite对URI的处理行为</span></span>
<span class="line"><span>Synatx: rewrite regex replacement [flag]</span></span>
<span class="line"><span>Default: -</span></span>
<span class="line"><span>Context: server,location,if</span></span></code></pre></div><ul><li>如果正则表达式(regex)匹配到了请求得到 URI，这个 URI 会被后面的 replacement 替换</li><li>rewrite 的定向会根据他们在配置文件中出现的顺序依次执行</li><li>通过 flag 可以终止定向后进一步的处理</li></ul><p><strong>用途</strong></p><ul><li>URL 页面跳转</li><li>兼容旧版本</li><li>SEO 优化(伪静态)</li><li>维护(后台维护、流量转发)</li><li>等</li></ul><p><strong>案例</strong></p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> / </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      # 如果url符合^(.*)$正则 则会打开root路径下的back.html</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            rewrite</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> ^(.*)$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /back.html </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">break</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> /bd </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      # 如果url符合^(.*)$正则 则会跳转baidu官网</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            rewrite</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> ^(.*)$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> http://www.baidu.com </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">break</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="_14-1-flag-参数" tabindex="-1">14.1 flag 参数 <a class="header-anchor" href="#_14-1-flag-参数" aria-label="Permalink to &quot;14.1 flag 参数&quot;">​</a></h2><p><strong>flag:用来设置 rewrite 对 URI 的处理行为</strong></p><table tabindex="0"><thead><tr><th>flag</th><th>含义</th></tr></thead><tbody><tr><td>last</td><td>先匹配自己的 location，然后通过 rewrite 规则新建一个请求再次请求服务端</td></tr><tr><td>break</td><td>先匹配自己的 location，然后生命周期会在当前的 location 结束，不再进行后续的匹配</td></tr><tr><td>redirect</td><td>返回 302 临时重定向，以后还会请求这个服务器</td></tr><tr><td>premanent</td><td>返回 301 永久重定向，以后会直接请求永久重定向后的域名</td></tr></tbody></table><p><strong>last</strong></p><ul><li>结束当前的请求处理，用替换后的 URI 重新匹配 location</li><li>可以理解为重写(rewrite)后，发起了一个新的请求，进入 server 模块，匹配 location</li><li>如果重新匹配循环的次数超过了 10 次，nginx 会返回 500 的错误</li><li>返回的 200 的状态码。</li></ul><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 如果符合location 那么则会使用/test在server模块中重新进行匹配</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 所以会返回200的状态码</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    location</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ~</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">  ^/last </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            rewrite</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ^/last /test </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">last</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> /test </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 200</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;hh你好&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>break</strong></p><ul><li>结束当前的请求处理，使用当前资源，不在执行当前 location 的余下语句</li><li>返回 301 状态码</li><li>浏览器地址显示从定向后的 url</li></ul><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       location</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ~</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">  ^/break1 </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            # 会把^/break1替换成/test</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            # 相当于使用这个路径 http://location/test</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            # 那么其实就是去找。 /test/index.html</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            rewrite</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ^/break1 /test </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">break</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            index </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">index.html;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            # 不在执行这个语句</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            rewrite</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ^/break /test </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">break</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>redirect</strong></p><ul><li>临时跳转，返回 302 http 状态码</li><li>浏览器地址显示重定向后的 url</li><li>临时重定向，下次请求还走 nginx</li></ul><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    location</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ~</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> ^/redirect </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            rewrite</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ^/redirect http://www.baidu.com </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">redirect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>permanent</strong></p><ul><li>永久跳转，返回 301 http 状态码</li><li>浏览器地址显示重定向后的 url</li><li>永久重定向，下次请求不走 nginx，直接访问重定向的地址</li></ul><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    location</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ~</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> ^/permanent </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            rewrite</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ^/permanent http://www.qq.com </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">permanent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div></div></div></main><footer class="VPDocFooter" data-v-59f87038 data-v-9b6d7c9e><!--[--><!--]--><!----><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-9b6d7c9e><span class="visually-hidden" id="doc-footer-aria-label" data-v-9b6d7c9e>Pager</span><div class="pager" data-v-9b6d7c9e><!----></div><div class="pager" data-v-9b6d7c9e><a class="VPLink link pager-link next" href="/flow/docs/tt.html" data-v-9b6d7c9e><!--[--><span class="desc" data-v-9b6d7c9e>Next page</span><span class="title" data-v-9b6d7c9e>环境区别</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"engineering_mysql.md\":\"SK8YAVYd\",\"engineering_node-basic.md\":\"BNzKNbuV\",\"engineering_node-high.md\":\"1oGbJ-EQ\",\"engineering_tool.md\":\"BWQb8gIi\",\"engineering_webpack.md\":\"D1kdmGRt\",\"index.md\":\"DLxdTMep\",\"javascript_index.md\":\"CN5y-F28\",\"linux_index.md\":\"Cot9xich\",\"linux_shell.md\":\"_c8L6W0u\",\"linux_software-package.md\":\"DLxF86Ug\",\"nginx_index.md\":\"CqoPmPz4\",\"react_index.md\":\"DJhrtgFo\",\"react_react-high.md\":\"CdB1186L\",\"react_react-hooks.md\":\"DSGDZ3Gx\",\"react_react-router.md\":\"B2JBw3or\",\"react_redux.md\":\"BCxBCdPg\",\"tt.md\":\"BeKqsaz7\",\"typescript_index.md\":\"BrtrWUVv\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"葡挞的资料库\",\"description\":\"葡挞的资料库\",\"base\":\"/flow/docs/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"search\":{\"provider\":\"local\"},\"nav\":[{\"text\":\"首页\",\"link\":\"/\"},{\"text\":\"文档\",\"link\":\"/javascript\"}],\"sidebar\":[{\"text\":\"环境区别\",\"items\":[{\"text\":\"环境区别\",\"link\":\"/tt\"}]},{\"text\":\"Javascript\",\"items\":[{\"text\":\"js高级\",\"link\":\"/javascript\"}]},{\"text\":\"React\",\"items\":[{\"text\":\"react基础\",\"link\":\"/react\"},{\"text\":\"react高级\",\"link\":\"/react/react-high\"},{\"text\":\"reactHooks\",\"link\":\"/react/react-hooks\"},{\"text\":\"reactRouter\",\"link\":\"/react/react-router\"},{\"text\":\"redux\",\"link\":\"/react/redux\"}]},{\"text\":\"Typescript\",\"items\":[{\"text\":\"typescript\",\"link\":\"/typescript\"}]},{\"text\":\"工程化\",\"items\":[{\"text\":\"node基础\",\"link\":\"/engineering/node-basic\"},{\"text\":\"node高级\",\"link\":\"/engineering/node-high\"},{\"text\":\"webpack\",\"link\":\"/engineering/webpack\"},{\"text\":\"mysql\",\"link\":\"/engineering/mysql\"},{\"text\":\"前端工具\",\"link\":\"/engineering/tool\"}]},{\"text\":\"Linux\",\"items\":[{\"text\":\"Linux基础\",\"link\":\"/linux\"},{\"text\":\"Shell\",\"link\":\"/linux/shell\"},{\"text\":\"软件包管理\",\"link\":\"/linux/software-package\"}]},{\"text\":\"Nginx\",\"items\":[{\"text\":\"Nginx\",\"link\":\"/nginx\"}]}],\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/vuejs/vitepress\"}]},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>