# 分层的意义

当遇到一个复杂问题的时候，可以使用分层的思想把问题简单化

比如，你有半杯 82 年的可乐，想分享给你的朋友王富贵，但你们已经 10 年没有联系了。要完成这件事，你可能要考虑：

- 我用什么装可乐？

  可能的方案：塑料瓶、玻璃瓶、煤气罐

- 怎么保证可乐始终处于低温？

  可能的方案：保温杯、小冰箱、冰盒

- 如何保证可乐不被运输的人偷喝？

  可能的方案：封条、在上面写「毒药」

- 如何获取王富贵的地址？

  可能的方案：报案失踪、联系私人侦探、联系物流公司的朋友

- 如何运输？

  可能的方案：自行车、汽车、火车、高铁、飞机、火箭

这就形成了一个分层结构

<img src="http://mdrs.yuanjin.tech/img/20210927145456.png" alt="image-20210927145456656" style="zoom:50%;" />

从常理出发，我们可以得出以下结论：

- 每层相对独立，只需解决自己的问题
- 每层无须考虑上层的交付，仅需把自己的结果交给下层即可
- 每层有多种方案可供选择，选择不同的方案不会对上下层造成影响
- 每一层会在上一层的基础上增加一些额外信息

# 五层网络模型

![image-20211008163417521](http://mdrs.yuanjin.tech/img/20211008163417.png)

# 数据的封装和解封装

![image-20211008163458168](http://mdrs.yuanjin.tech/img/20211008163458.png)

# 四层、五层、七层

![image-20211008164017299](http://mdrs.yuanjin.tech/img/20211008164017.png)

### **1. 四层模型（TCP/IP 模型）**

- **确实是全球通用的标准模型**。
  - 四层模型，也叫 **TCP/IP 协议栈** 或 **互联网协议栈**，是在互联网发展初期（20 世纪 70 年代）由美国国防部的 ARPANET 项目提出的。它是完全基于互联网的实用需求而设计，并没有考虑太多理论上的分层，目标是实现网络互联和数据通信。
  - **四个层次**分别是：
    - **应用层**（Application）：为用户提供服务，涵盖 HTTP、FTP、SMTP 等。
    - **传输层**（Transport）：确保端到端数据传输的可靠性（如 TCP）或效率（如 UDP）。
    - **网际层（网络层）**（Internet）：负责数据的路由和寻址（如 IP 协议）。
    - **网络接口层（数据链路 + 物理层）**（Network Interface/Link）：负责实际的数据帧传输，结合硬件完成底层通信。

**总结**：TCP/IP 协议（四层）是当前互联网的实际标准，各大公司和机构的网络设备和通信协议基本都基于这一模型。

---

### **2. 七层模型（OSI 模型）**

- **确实是更偏理论的通用网络互联框架**。
  - 七层模型是 1984 年国际标准化组织（ISO）在 TCP/IP 成功经验的基础上发布的 **OSI（Open Systems Interconnection）参考模型**，用以标准化网络通信描述。
  - **七个层次**：
    1.  物理层、2. 数据链路层、3. 网络层、4. 传输层、5. 会话层、6. 表示层、7. 应用层
  - 七层模型的主要目标：
    1. 为网络协议提供理论上的完整框架。
    2. 为设备厂商和开发者提供设计网络时的通用标准。
    3. 偏向教学和研究领域的“理想模型”，而非实践中的实际实现。

**问题**：  
虽然 OSI 的理念很先进，但其设计复杂性高，且开发出来的协议（如 X.25、OSI 协议族）并没有在实际中流行，而是被更简单的 TCP/IP 设计取代。因此，七层模型被更多地用作一种框架和教学工具，在实际网络中并不直接使用（正如你所说的，它更多存在于理论和教科书中）。

---

### **3. 五层模型**

- **五层模型是实践和教学之间的折中版本**。
  - 五层模型是从 OSI 七层模型借鉴而来的，但做了适当简化，使其更贴合实际网络实践，同时依然完整地描述了通信流程。五层模型的层级是：
    1. 物理层、2. 数据链路层、3. 网络层、4. 传输层、5. 应用层（合并了 OSI 中的应用层、会话层、表示层）。

**设计思路**：

- 五层模型的目标是提供一个完整通信流程的框架，但剔除了实际网络中不常用的会话层和表示层的独立实现。
- 在工程实践或教育环境中，五层模型非常常用，既符合实际实现情况，又便于理解通信的层次化。

---

### **4. 五层与四层的关系**

- **四层模型（TCP/IP）**：将物理层和数据链路层合并，统称为“网络接口层”或“链路层”。因此，它就是四层。
- **五层模型**：物理层和数据链路层分开，保留 OSI 模型中的五个关键逻辑层。

两种模型没有本质矛盾，用的是同一套传输协议栈，层次的划分主要是为了符合**教学**或**实际工程**的需求。

---

### **完整总结：**

1. **四层模型（TCP/IP）**：实际互联网的标准，全球普遍认可并应用，侧重功能实现。
2. **七层模型（OSI）**：理论化模式，存在于学术研究和教科书，用于描述通信的完整功能框架。
3. **五层模型**：从七层理论简化而来，更贴近实际应用，同时也保留了教学性和逻辑性，主要为理解通信全过程服务。

五层和四层都可以用来解释现代网络协议的分层机制，只是表达方式不同（五层分开数据链路层和物理层，而四层则合并）。

但更精确地说：

- 五层模型不能完全算“网络协议”，而是一种对协议分层的教学抽象模型。
- 四层模型是网络协议（TCP/IP）的实际标准，而五层模型可以说是它的“变种解释”。

# 面试题

说说网络的五层模型（寺库）

> 参考答案：
>
> 从上到下分别为：应用层、传输层、网络层、数据链路层、物理层。在发送消息时，消息从上到下进行打包，每一层会在上一层基础上加包，而接受消息时，从下到上进行解包，最终得到原始信息。
>
> 其中：
>
> 应用层主要面向互联网中的应用场景，比如网页、邮件、文件中心等等，它的代表协议有 http、smtp、pop3、ftp、DNS 等等
>
> 传输层主要面向传输过程，比如 TCP 协议是为了保证可靠的传输，而 UDP 协议则是一种无连接的广播，它们提供了不同的传输方式
>
> 网络层主要解决如何定位目标以及如何寻找最优路径的问题，比如 IP 等等
>
> 数据链路层的作用是将数据在一个子网（广播域）内有效传输，MAC 地址、交换机都是属于该层的
>
> 物理层是要解决二进制数据到信号之间的互转问题，集线器、双绞线、同轴电缆等都是属于盖层的设备
